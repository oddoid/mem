#!/usr/bin/env sh
export PNG_FILENAME="$1"
export XCF_FILENAME="$2"
exec gimp --batch-interpreter=python-fu-eval -idfb - << 'eof'

import gimpfu
import os

png_filename = os.environ['PNG_FILENAME']
xcf_filename = os.environ['XCF_FILENAME']

img = pdb.gimp_file_load(xcf_filename, xcf_filename)

layer = pdb.gimp_image_merge_visible_layers(img, CLIP_TO_IMAGE)

pdb.gimp_file_save(img, layer, png_filename, png_filename)

pdb.gimp_quit(True)